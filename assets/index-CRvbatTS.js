import{_ as F,l as d,R as ve,e as z}from"./monaco-BOYU588y.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=r(s);fetch(s.href,i)}})();function Se(t){return new Worker("/Verse/assets/editor.worker-b0HUMjXM.js",{name:t==null?void 0:t.name})}var o=(t=>(t.NUMBER="NUMBER",t.STRING="STRING",t.TRUE="TRUE",t.FALSE="FALSE",t.NULL="NULL",t.IDENTIFIER="IDENTIFIER",t.LET="LET",t.CONST="CONST",t.IF="IF",t.ELSE="ELSE",t.FOR="FOR",t.IN="IN",t.RETURN="RETURN",t.FN="FN",t.TYPE="TYPE",t.INTERFACE="INTERFACE",t.PLUS="PLUS",t.MINUS="MINUS",t.STAR="STAR",t.SLASH="SLASH",t.PERCENT="PERCENT",t.EQUALS="EQUALS",t.EQUALS_EQUALS="EQUALS_EQUALS",t.BANG_EQUALS="BANG_EQUALS",t.LESS="LESS",t.LESS_EQUALS="LESS_EQUALS",t.GREATER="GREATER",t.GREATER_EQUALS="GREATER_EQUALS",t.AMPERSAND_AMPERSAND="AMPERSAND_AMPERSAND",t.PIPE_PIPE="PIPE_PIPE",t.BANG="BANG",t.QUESTION="QUESTION",t.LPAREN="LPAREN",t.RPAREN="RPAREN",t.LBRACE="LBRACE",t.RBRACE="RBRACE",t.LBRACKET="LBRACKET",t.RBRACKET="RBRACKET",t.COMMA="COMMA",t.DOT="DOT",t.COLON="COLON",t.RETURN_ARROW="RETURN_ARROW",t.FAT_ARROW="FAT_ARROW",t.PIPE="PIPE",t.EOF="EOF",t))(o||{});class Ee{constructor(e){this.pos=0,this.line=1,this.column=1,this.source=e}tokenize(){const e=[];for(;this.pos<this.source.length&&(this.skipWhitespace(),!(this.pos>=this.source.length));){const r=this.nextToken();r&&e.push(r)}return e.push({type:"EOF",value:"",line:this.line,column:this.column}),e}nextToken(){const e=this.pos,r=this.column,n=this.source[e],s={"(":"LPAREN",")":"RPAREN","{":"LBRACE","}":"RBRACE","[":"LBRACKET","]":"RBRACKET",",":"COMMA",".":"DOT",":":"COLON","+":"PLUS","*":"STAR","/":"SLASH","%":"PERCENT","?":"QUESTION"};if(s[n])return this.advance(),{type:s[n],value:n,line:this.line,column:r};if(n==="=")return this.advance(),this.peek()==="="?(this.advance(),{type:"EQUALS_EQUALS",value:"==",line:this.line,column:r}):this.peek()===">"?(this.advance(),{type:"FAT_ARROW",value:"=>",line:this.line,column:r}):{type:"EQUALS",value:"=",line:this.line,column:r};if(n==="!")return this.advance(),this.peek()==="="?(this.advance(),{type:"BANG_EQUALS",value:"!=",line:this.line,column:r}):{type:"BANG",value:"!",line:this.line,column:r};if(n==="<")return this.advance(),this.peek()==="="?(this.advance(),{type:"LESS_EQUALS",value:"<=",line:this.line,column:r}):{type:"LESS",value:"<",line:this.line,column:r};if(n===">")return this.advance(),this.peek()==="="?(this.advance(),{type:"GREATER_EQUALS",value:">=",line:this.line,column:r}):{type:"GREATER",value:">",line:this.line,column:r};if(n==="&"){if(this.advance(),this.peek()==="&")return this.advance(),{type:"AMPERSAND_AMPERSAND",value:"&&",line:this.line,column:r};this.backup()}if(n==="|")return this.advance(),this.peek()==="|"?(this.advance(),{type:"PIPE_PIPE",value:"||",line:this.line,column:r}):{type:"PIPE",value:"|",line:this.line,column:r};if(n==="-")return this.advance(),this.isDigit(this.peek())?this.scanNumber(!0):this.peek()===">"?(this.advance(),{type:"RETURN_ARROW",value:"->",line:this.line,column:r}):{type:"MINUS",value:"-",line:this.line,column:r};if(n==='"'||n==="'")return this.scanString(n);if(this.isDigit(n))return this.scanNumber();if(this.isAlpha(n))return this.scanIdentifier();throw new Error(`Unexpected character '${n}' at line ${this.line}, column ${this.column}`)}scanString(e){const r=this.column;this.advance();let n="";for(;this.pos<this.source.length&&this.source[this.pos]!==e;){if(this.source[this.pos]==="\\"){this.advance();const s=this.source[this.pos];n+=s==="n"?`
`:s==="t"?"	":s}else n+=this.source[this.pos];this.advance()}if(this.pos>=this.source.length)throw new Error(`Unterminated string at line ${this.line}`);return this.advance(),{type:"STRING",value:n,line:this.line,column:r}}scanNumber(e=!1){const r=this.column;let n=e?"-":"";for(;this.isDigit(this.peek());)n+=this.source[this.pos],this.advance();if(this.peek()==="."&&this.isDigit(this.source[this.pos+1]))for(n+=this.source[this.pos],this.advance();this.isDigit(this.peek());)n+=this.source[this.pos],this.advance();return{type:"NUMBER",value:n,line:this.line,column:r}}scanIdentifier(){const e=this.column;let r="";for(;this.isAlphaNumeric(this.peek());)r+=this.source[this.pos],this.advance();return{type:{let:"LET",const:"CONST",if:"IF",else:"ELSE",for:"FOR",in:"IN",return:"RETURN",fn:"FN",type:"TYPE",interface:"INTERFACE",true:"TRUE",false:"FALSE",null:"NULL"}[r]||"IDENTIFIER",value:r,line:this.line,column:e}}skipWhitespace(){for(;this.pos<this.source.length;){const e=this.source[this.pos];if(e===" "||e==="	"||e==="\r")this.advance();else if(e===`
`)this.advance(),this.line++,this.column=1;else if(e==="/"&&this.source[this.pos+1]==="/")for(;this.pos<this.source.length&&this.source[this.pos]!==`
`;)this.advance();else break}}peek(){return this.source[this.pos]||""}backup(){this.pos--,this.column--}advance(){this.pos++,this.column++}isDigit(e){return e>="0"&&e<="9"}isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_"}isAlphaNumeric(e){return this.isAlpha(e)||this.isDigit(e)}}class ge{constructor(e){this.pos=0,this.tokens=e}parse(){const e=[];for(;!this.isAtEnd();)e.push(this.statement());return{type:"Program",body:e}}statement(){return this.match(o.TYPE)?this.typeDeclaration():this.match(o.INTERFACE)?this.interfaceDeclaration():this.match(o.LET,o.CONST)?this.variableDeclaration():this.match(o.FN)?this.functionDeclaration():this.match(o.RETURN)?this.returnStatement():this.match(o.IF)?this.ifStatement():this.match(o.FOR)?this.forStatement():this.expressionStatement()}typeDeclaration(){const e=this.consume(o.IDENTIFIER,"Expected type name").value;this.consume(o.EQUALS,"Expected = after type name");const r=this.parseTypeAnnotation();return{type:"TypeDeclaration",name:e,typeAnnotation:r}}interfaceDeclaration(){const e=this.consume(o.IDENTIFIER,"Expected interface name").value;this.consume(o.LBRACE,"Expected { after interface name");const r=[];for(;!this.check(o.RBRACE)&&!this.isAtEnd();){const n=this.consume(o.IDENTIFIER,"Expected property name").value;this.consume(o.COLON,"Expected : after property name");const s=this.parseTypeAnnotation();r.push({key:n,typeAnnotation:s}),this.match(o.COMMA)}return this.consume(o.RBRACE,"Expected } after interface body"),{type:"InterfaceDeclaration",name:e,properties:r}}variableDeclaration(){const e=this.previous().type===o.CONST,r=this.consume(o.IDENTIFIER,"Expected variable name").value;let n;this.match(o.COLON)&&(n=this.parseTypeAnnotation()),this.consume(o.EQUALS,"Expected = after variable name");const s=this.expression();return{type:"VariableDeclaration",identifier:r,value:s,constant:e,typeAnnotation:n}}functionDeclaration(){const e=this.consume(o.IDENTIFIER,"Expected function name").value;this.consume(o.LPAREN,"Expected ( after function name");const r=[];if(!this.check(o.RPAREN))do{const i=this.consume(o.IDENTIFIER,"Expected parameter name").value;let a;this.match(o.COLON)&&(a=this.parseTypeAnnotation()),r.push({name:i,typeAnnotation:a})}while(this.match(o.COMMA));this.consume(o.RPAREN,"Expected ) after parameters");let n;this.match(o.RETURN_ARROW)&&(n=this.parseTypeAnnotation()),this.consume(o.LBRACE,"Expected { before function body");const s=[];for(;!this.check(o.RBRACE)&&!this.isAtEnd();)s.push(this.statement());return this.consume(o.RBRACE,"Expected } after function body"),{type:"FunctionDeclaration",name:e,params:r,returnTypeAnnotation:n,body:s}}returnStatement(){return{type:"ReturnStatement",value:this.check(o.RBRACE)||this.isAtEnd()?null:this.expression()}}ifStatement(){const e=this.expression();this.consume(o.LBRACE,"Expected { after if condition");const r=[];for(;!this.check(o.RBRACE)&&!this.isAtEnd();)r.push(this.statement());this.consume(o.RBRACE,"Expected } after if body");let n=null;if(this.match(o.ELSE)){for(this.consume(o.LBRACE,"Expected { after else"),n=[];!this.check(o.RBRACE)&&!this.isAtEnd();)n.push(this.statement());this.consume(o.RBRACE,"Expected } after else body")}return{type:"IfStatement",condition:e,consequent:r,alternate:n}}forStatement(){const e=this.consume(o.IDENTIFIER,"Expected variable name in for loop").value;this.consume(o.IN,'Expected "in" in for loop');const r=this.expression();this.consume(o.LBRACE,"Expected { after for header");const n=[];for(;!this.check(o.RBRACE)&&!this.isAtEnd();)n.push(this.statement());return this.consume(o.RBRACE,"Expected } after for body"),{type:"ForStatement",variable:e,iterable:r,body:n}}expressionStatement(){return{type:"ExpressionStatement",expression:this.expression()}}parseTypeAnnotation(){const e=[];for(e.push(this.parseSingleType());this.match(o.PIPE);)e.push(this.parseSingleType());return e.length===1?e[0]:{type:"UnionType",types:e}}parseSingleType(){const e=this.parseBaseType();return this.match(o.LBRACKET)?(this.consume(o.RBRACKET,"Expected ] after ["),{type:"ArrayType",elementType:e}):e}parseBaseType(){const e=this.peek();if(e.type===o.IDENTIFIER){const r=e.value;if(r==="number"||r==="string"||r==="boolean"||r==="null")return this.advance(),{type:"PrimitiveType",name:r}}if(e.type===o.NULL)return this.advance(),{type:"PrimitiveType",name:e.value};if(this.match(o.LBRACE)){const r=[];for(;!this.check(o.RBRACE)&&!this.isAtEnd();){const n=this.consume(o.IDENTIFIER,"Expected property name").value;this.consume(o.COLON,"Expected : after property name");const s=this.parseTypeAnnotation();r.push({key:n,valueType:s}),this.match(o.COMMA)}return this.consume(o.RBRACE,"Expected }"),{type:"ObjectType",properties:r}}if(this.check(o.IDENTIFIER))return{type:"TypeReference",name:this.advance().value};throw new Error(`Expected type annotation at line ${e.line}`)}expression(){return this.assignment()}assignment(){const e=this.conditional();if(this.match(o.EQUALS)){const r=this.assignment();return{type:"AssignmentExpression",target:e,value:r}}return e}conditional(){const e=this.logicalOr();if(this.match(o.QUESTION)){const r=this.expression();this.consume(o.COLON,"Expected : in ternary expression");const n=this.expression();return{type:"ConditionalExpression",test:e,consequent:r,alternate:n}}return e}logicalOr(){let e=this.logicalAnd();for(;this.match(o.PIPE_PIPE);){const r=this.previous().value,n=this.logicalAnd();e={type:"BinaryExpression",operator:r,left:e,right:n}}return e}logicalAnd(){let e=this.equality();for(;this.match(o.AMPERSAND_AMPERSAND);){const r=this.previous().value,n=this.equality();e={type:"BinaryExpression",operator:r,left:e,right:n}}return e}equality(){let e=this.comparison();for(;this.match(o.EQUALS_EQUALS,o.BANG_EQUALS);){const r=this.previous().value,n=this.comparison();e={type:"BinaryExpression",operator:r,left:e,right:n}}return e}comparison(){let e=this.additive();for(;this.match(o.LESS,o.LESS_EQUALS,o.GREATER,o.GREATER_EQUALS);){const r=this.previous().value,n=this.additive();e={type:"BinaryExpression",operator:r,left:e,right:n}}return e}additive(){let e=this.multiplicative();for(;this.match(o.PLUS,o.MINUS);){const r=this.previous().value,n=this.multiplicative();e={type:"BinaryExpression",operator:r,left:e,right:n}}return e}multiplicative(){let e=this.unary();for(;this.match(o.STAR,o.SLASH,o.PERCENT);){const r=this.previous().value,n=this.unary();e={type:"BinaryExpression",operator:r,left:e,right:n}}return e}unary(){if(this.match(o.BANG,o.MINUS)){const e=this.previous().value,r=this.unary();return{type:"UnaryExpression",operator:e,operand:r}}return this.call()}call(){let e=this.member();for(;this.match(o.LPAREN);){const r=[];if(!this.check(o.RPAREN))do r.push(this.expression());while(this.match(o.COMMA));this.consume(o.RPAREN,"Expected ) after arguments"),e={type:"CallExpression",callee:e,arguments:r}}return e}member(){let e=this.primary();for(;;)if(this.match(o.DOT)){const r=this.consume(o.IDENTIFIER,"Expected property name").value;e={type:"MemberExpression",object:e,property:r,computed:!1}}else if(this.match(o.LBRACKET)){const r=this.expression();if(this.consume(o.RBRACKET,"Expected ] after index"),r.type==="Literal")e={type:"MemberExpression",object:e,property:String(r.value),computed:!0};else throw new Error("Complex computed member access not yet supported")}else break;return e}primary(){if(this.match(o.TRUE))return{type:"Literal",value:!0};if(this.match(o.FALSE))return{type:"Literal",value:!1};if(this.match(o.NULL))return{type:"Literal",value:null};if(this.match(o.NUMBER))return{type:"Literal",value:parseFloat(this.previous().value)};if(this.match(o.STRING))return{type:"Literal",value:this.previous().value};if(this.match(o.IDENTIFIER)){const e=this.previous().value;if(this.match(o.FAT_ARROW)){const r=this.expression();return{type:"ArrowFunction",params:[e],body:r}}return{type:"Identifier",name:e}}if(this.match(o.LPAREN)){const e=this.pos,r=[];if(!this.check(o.RPAREN)&&this.check(o.IDENTIFIER))for(r.push(this.advance().value);this.match(o.COMMA);)r.push(this.consume(o.IDENTIFIER,"Expected parameter").value);if(this.match(o.RPAREN)&&this.match(o.FAT_ARROW)){const s=this.expression();return{type:"ArrowFunction",params:r,body:s}}this.pos=e;const n=this.expression();return this.consume(o.RPAREN,"Expected ) after expression"),n}if(this.match(o.LBRACKET)){const e=[];if(!this.check(o.RBRACKET))do e.push(this.expression());while(this.match(o.COMMA));return this.consume(o.RBRACKET,"Expected ] after array elements"),{type:"ArrayExpression",elements:e}}if(this.match(o.LBRACE)){const e=[];if(!this.check(o.RBRACE))do{const r=this.consume(o.IDENTIFIER,"Expected property key").value;this.consume(o.COLON,"Expected : after property key");const n=this.expression();e.push({key:r,value:n})}while(this.match(o.COMMA));return this.consume(o.RBRACE,"Expected } after object properties"),{type:"ObjectExpression",properties:e}}throw new Error(`Unexpected token: ${this.peek().type} at line ${this.peek().line}`)}match(...e){for(const r of e)if(this.check(r))return this.advance(),!0;return!1}check(e){return this.isAtEnd()?!1:this.peek().type===e}advance(){return this.isAtEnd()||this.pos++,this.previous()}isAtEnd(){return this.peek().type===o.EOF}peek(){return this.tokens[this.pos]}previous(){return this.tokens[this.pos-1]}consume(e,r){if(this.check(e))return this.advance();throw new Error(`${r} at line ${this.peek().line}, got ${this.peek().type}`)}}const c={number:{kind:"primitive",name:"number"},string:{kind:"primitive",name:"string"},boolean:{kind:"primitive",name:"boolean"},null:{kind:"primitive",name:"null"},unknown:{kind:"unknown"}};class we{constructor(e){if(this.symbolTable=new Map,this.customTypes=new Map,e)for(const[r,n]of Object.entries(e))this.symbolTable.set(r,n)}registerType(e,r){this.customTypes.set(e,r)}check(e){let r=c.unknown;for(const n of e.body)r=this.checkStatement(n);return r}inferReturnType(e){this.check(e);const r=[],n=s=>{for(const i of s)i.type==="ReturnStatement"?i.value&&r.push(this.inferExpression(i.value)):i.type==="IfStatement"?(n(i.consequent),i.alternate&&n(i.alternate)):i.type==="ForStatement"&&n(i.body)};return n(e.body),r.length===0?c.unknown:r.length===1?r[0]:{kind:"union",types:r}}checkStatement(e){switch(e.type){case"TypeDeclaration":return this.checkTypeDeclaration(e);case"InterfaceDeclaration":return this.checkInterfaceDeclaration(e);case"VariableDeclaration":return this.checkVariableDeclaration(e);case"FunctionDeclaration":return this.checkFunctionDeclaration(e);case"ReturnStatement":return e.value?this.inferExpression(e.value):c.unknown;case"IfStatement":return this.checkIfStatement(e);case"ForStatement":return this.checkForStatement(e);case"ExpressionStatement":return this.inferExpression(e.expression);default:return c.unknown}}checkTypeDeclaration(e){const r=this.annotationToType(e.typeAnnotation);return this.customTypes.set(e.name,r),r}checkInterfaceDeclaration(e){const r={};for(const s of e.properties)r[s.key]=this.annotationToType(s.typeAnnotation);const n={kind:"object",name:e.name,properties:r};return this.customTypes.set(e.name,n),n}annotationToType(e){switch(e.type){case"PrimitiveType":return c[e.name];case"ArrayType":return{kind:"array",elementType:this.annotationToType(e.elementType)};case"ObjectType":const r={};for(const n of e.properties)r[n.key]=this.annotationToType(n.valueType);return{kind:"object",properties:r};case"UnionType":return{kind:"union",types:e.types.map(n=>this.annotationToType(n))};case"TypeReference":return this.customTypes.get(e.name)||c.unknown;default:return c.unknown}}checkVariableDeclaration(e){const r=this.inferExpression(e.value);if(e.typeAnnotation){const n=this.annotationToType(e.typeAnnotation);if(!this.isAssignable(r,n))throw new TypeError(`Cannot assign ${this.typeToString(r)} to ${this.typeToString(n)}`);return this.symbolTable.set(e.identifier,n),n}return this.symbolTable.set(e.identifier,r),r}checkFunctionDeclaration(e){const r=new Map(this.symbolTable),n=[];for(const u of e.params){const h=u.typeAnnotation?this.annotationToType(u.typeAnnotation):c.unknown;this.symbolTable.set(u.name,h),n.push(h)}const s=[];for(const u of e.body)u.type==="ReturnStatement"&&u.value&&s.push(this.inferExpression(u.value));const i=s.length>0?s.length===1?s[0]:{kind:"union",types:s}:c.unknown;let a=i;if(e.returnTypeAnnotation){const u=this.annotationToType(e.returnTypeAnnotation);if(!this.isAssignable(i,u))throw new TypeError(`Function ${e.name} returns ${this.typeToString(i)} but declared ${this.typeToString(u)}`);a=u}this.symbolTable=r;const l={kind:"function",parameters:n,returnType:a};return this.symbolTable.set(e.name,l),l}isAssignable(e,r){var n;if(this.typesEqual(e,r)||e.kind==="unknown"||r.kind==="unknown")return!0;if(r.kind==="union")return r.types.some(s=>this.isAssignable(e,s));if(e.kind==="array"&&r.kind==="array")return this.isAssignable(e.elementType,r.elementType);if(r.kind==="object"&&e.kind==="object"){for(const[s,i]of Object.entries(r.properties||{})){const a=(n=e.properties)==null?void 0:n[s];if(!a||!this.isAssignable(a,i))return!1}return!0}return!1}checkIfStatement(e){this.inferExpression(e.condition);const r=[];for(const n of e.consequent)r.push(this.checkStatement(n));if(e.alternate)for(const n of e.alternate)r.push(this.checkStatement(n));return r.length>0?r[r.length-1]:c.unknown}checkForStatement(e){const r=new Map(this.symbolTable),n=this.inferExpression(e.iterable);let s=c.unknown;n.kind==="array"&&n.elementType&&(s=n.elementType),this.symbolTable.set(e.variable,s);let i=c.unknown;for(const a of e.body)i=this.checkStatement(a);return this.symbolTable=r,i}inferExpression(e){switch(e.type){case"Literal":return this.inferLiteral(e);case"Identifier":return this.inferIdentifier(e);case"BinaryExpression":return this.inferBinaryExpression(e);case"UnaryExpression":return this.inferUnaryExpression(e);case"CallExpression":return this.inferCallExpression(e);case"MemberExpression":return this.inferMemberExpression(e);case"ArrayExpression":return this.inferArrayExpression(e);case"ObjectExpression":return this.inferObjectExpression(e);case"ConditionalExpression":return this.inferConditionalExpression(e);case"ArrowFunction":return this.inferArrowFunction(e);case"AssignmentExpression":const r=this.inferExpression(e.value);return e.target.type==="Identifier"&&this.symbolTable.set(e.target.name,r),r;default:return c.unknown}}inferLiteral(e){return typeof e.value=="number"?c.number:typeof e.value=="string"?c.string:typeof e.value=="boolean"?c.boolean:e.value===null?c.null:c.unknown}inferIdentifier(e){let r=this.symbolTable.get(e.name);return(!r||r.kind==="unknown")&&(r=this.customTypes.get(e.name)),r||(r=c.unknown),r}inferBinaryExpression(e){const r=this.inferExpression(e.left),n=this.inferExpression(e.right);return["+","-","*","/","%"].includes(e.operator)?e.operator==="+"&&(r.kind==="primitive"&&r.name==="string"||n.kind==="primitive"&&n.name==="string")?c.string:c.number:["==","!=","<","<=",">",">="].includes(e.operator)||["&&","||"].includes(e.operator)?c.boolean:c.unknown}inferUnaryExpression(e){const r=this.inferExpression(e.operand);return e.operator==="!"?c.boolean:e.operator==="-"?c.number:r}inferCallExpression(e){const r=this.inferExpression(e.callee);if(e.callee.type==="MemberExpression"){const n=this.inferExpression(e.callee.object),s=e.callee.property;if(n.kind==="array"&&n.elementType){if(["filter","map","slice","concat"].includes(s))return s==="map"&&e.arguments.length>0,n;if(["find","at"].includes(s))return n.elementType;if(["length","findIndex","indexOf"].includes(s))return c.number;if(["some","every","includes"].includes(s))return c.boolean}}return r.kind==="function"&&r.returnType?r.returnType:c.unknown}inferMemberExpression(e){const r=this.inferExpression(e.object);return r.kind==="object"&&r.properties?r.properties[e.property]||c.unknown:r.kind==="array"&&e.property==="length"?c.number:c.unknown}inferArrayExpression(e){return e.elements.length===0?{kind:"array",elementType:c.unknown}:{kind:"array",elementType:this.inferExpression(e.elements[0])}}inferObjectExpression(e){const r={};for(const n of e.properties)r[n.key]=this.inferExpression(n.value);return{kind:"object",properties:r}}inferConditionalExpression(e){const r=this.inferExpression(e.consequent),n=this.inferExpression(e.alternate);return this.typesEqual(r,n)?r:{kind:"union",types:[r,n]}}inferArrowFunction(e){const r=new Map(this.symbolTable);for(const s of e.params)this.symbolTable.set(s,c.unknown);const n=this.inferExpression(e.body);return this.symbolTable=r,{kind:"function",parameters:e.params.map(()=>c.unknown),returnType:n}}typesEqual(e,r){return e.kind!==r.kind?!1:e.kind==="primitive"&&r.kind==="primitive"?e.name===r.name:e.kind==="array"&&r.kind==="array"?this.typesEqual(e.elementType,r.elementType):!1}typeToString(e){switch(e.kind){case"primitive":return e.name||"unknown";case"array":return`${this.typeToString(e.elementType)}[]`;case"object":return e.name?e.name:`{ ${Object.entries(e.properties||{}).map(([s,i])=>`${s}: ${this.typeToString(i)}`).join(", ")} }`;case"function":return`(${(e.parameters||[]).map(s=>this.typeToString(s)).join(", ")}) => ${this.typeToString(e.returnType)}`;case"union":return(e.types||[]).map(s=>this.typeToString(s)).join(" | ");case"unknown":return"unknown";default:return"unknown"}}}class be{generate(e){return e.body.map(r=>this.generateStatement(r)).filter(r=>r!=="").join(`
`)}generateStatement(e){switch(e.type){case"TypeDeclaration":return"";case"InterfaceDeclaration":return"";case"VariableDeclaration":return`${e.constant?"const":"let"} ${e.identifier} = ${this.generateExpression(e.value)};`;case"FunctionDeclaration":const n=e.params.map(m=>m.name).join(", "),s=e.body.map(m=>this.generateStatement(m)).join(`
`);return`function ${e.name}(${n}) {
${s}
}`;case"ReturnStatement":return e.value?`return ${this.generateExpression(e.value)};`:"return;";case"IfStatement":const i=this.generateExpression(e.condition),a=e.consequent.map(m=>this.generateStatement(m)).join(`
`),l=e.alternate?`else {
${e.alternate.map(m=>this.generateStatement(m)).join(`
`)}
}`:"";return`if (${i}) {
${a}
} ${l}`;case"ForStatement":const u=this.generateExpression(e.iterable),h=e.body.map(m=>this.generateStatement(m)).join(`
`);return`for (const ${e.variable} of ${u}) {
${h}
}`;case"ExpressionStatement":return`${this.generateExpression(e.expression)};`;default:return""}}generateExpression(e){switch(e.type){case"Literal":return typeof e.value=="string"?`"${e.value}"`:String(e.value);case"Identifier":return e.name;case"BinaryExpression":return`(${this.generateExpression(e.left)} ${e.operator} ${this.generateExpression(e.right)})`;case"UnaryExpression":return`${e.operator}${this.generateExpression(e.operand)}`;case"CallExpression":const r=this.generateExpression(e.callee),n=e.arguments.map(h=>this.generateExpression(h)).join(", ");return`${r}(${n})`;case"MemberExpression":const s=this.generateExpression(e.object);return e.computed?`${s}[${e.property}]`:`${s}.${e.property}`;case"ArrayExpression":return`[${e.elements.map(h=>this.generateExpression(h)).join(", ")}]`;case"ObjectExpression":return`{ ${e.properties.map(h=>`${h.key}: ${this.generateExpression(h.value)}`).join(", ")} }`;case"ConditionalExpression":return`(${this.generateExpression(e.test)} ? ${this.generateExpression(e.consequent)} : ${this.generateExpression(e.alternate)})`;case"ArrowFunction":const l=e.params.join(", "),u=this.generateExpression(e.body);return`(${l}) => ${u}`;case"AssignmentExpression":return`${this.generateExpression(e.target)} = ${this.generateExpression(e.value)}`;default:return""}}}class g{constructor(e){this.typeChecker=new we(e)}registerType(e,r){this.typeChecker.registerType(e,r)}compile(e){try{const n=new Ee(e).tokenize(),i=new ge(n).parse(),a=this.typeChecker.inferReturnType(i),l=this.typeChecker.typeToString(a),h=new be().generate(i);return{success:!0,returnType:l,code:h}}catch(r){return{success:!1,error:r.message}}}static createObjectType(e,r){return{kind:"object",name:e,properties:r}}static createArrayType(e){return{kind:"array",elementType:e}}}var x={JS_EVAL_TYPE_GLOBAL:0,JS_EVAL_TYPE_MODULE:1,JS_EVAL_FLAG_STRICT:8,JS_EVAL_FLAG_STRIP:16,JS_EVAL_FLAG_COMPILE_ONLY:32,JS_EVAL_FLAG_BACKTRACE_BARRIER:64},V={BaseObjects:1,Date:2,Eval:4,StringNormalize:8,RegExp:16,RegExpCompiler:32,JSON:64,Proxy:128,MapSet:256,TypedArrays:512,Promise:1024,BigInt:2048,BigFloat:4096,BigDecimal:8192,OperatorOverloading:16384,BignumExt:32768},N={Pending:0,Fulfilled:1,Rejected:2},A={JS_GPN_STRING_MASK:1,JS_GPN_SYMBOL_MASK:2,JS_GPN_PRIVATE_MASK:4,JS_GPN_ENUM_ONLY:16,QTS_GPN_NUMBER_MASK:64,QTS_STANDARD_COMPLIANT_NUMBER:128},C={IsStrictlyEqual:0,IsSameValue:1,IsSameValueZero:2},xe=Object.defineProperty,Ae=(t,e)=>{for(var r in e)xe(t,r,{get:e[r],enumerable:!0})};function R(...t){}var Te={};Ae(Te,{QuickJSAsyncifyError:()=>X,QuickJSAsyncifySuspended:()=>ee,QuickJSEmptyGetOwnPropertyNames:()=>ne,QuickJSEmscriptenModuleError:()=>D,QuickJSMemoryLeakDetected:()=>Re,QuickJSNotImplemented:()=>Z,QuickJSPromisePending:()=>re,QuickJSUnknownIntrinsic:()=>te,QuickJSUnwrapError:()=>Q,QuickJSUseAfterFree:()=>B,QuickJSWrongOwner:()=>Y});var Q=class extends Error{constructor(t,e){let r=typeof t=="object"&&t&&"message"in t?String(t.message):String(t);super(r),this.cause=t,this.context=e,this.name="QuickJSUnwrapError"}},Y=class extends Error{constructor(){super(...arguments),this.name="QuickJSWrongOwner"}},B=class extends Error{constructor(){super(...arguments),this.name="QuickJSUseAfterFree"}},Z=class extends Error{constructor(){super(...arguments),this.name="QuickJSNotImplemented"}},X=class extends Error{constructor(){super(...arguments),this.name="QuickJSAsyncifyError"}},ee=class extends Error{constructor(){super(...arguments),this.name="QuickJSAsyncifySuspended"}},Re=class extends Error{constructor(){super(...arguments),this.name="QuickJSMemoryLeakDetected"}},D=class extends Error{constructor(){super(...arguments),this.name="QuickJSEmscriptenModuleError"}},te=class extends TypeError{constructor(){super(...arguments),this.name="QuickJSUnknownIntrinsic"}},re=class extends Error{constructor(){super(...arguments),this.name="QuickJSPromisePending"}},ne=class extends Error{constructor(){super(...arguments),this.name="QuickJSEmptyGetOwnPropertyNames"}};function*se(t){return yield t}function ke(t){return se(J(t))}var H=se;H.of=ke;function G(t,e){return(...r)=>{let n=e.call(t,H,...r);return J(n)}}function Ce(t,e){let r=e.call(t,H);return J(r)}function J(t){function e(r){return r.done?r.value:r.value instanceof Promise?r.value.then(n=>e(t.next(n)),n=>e(t.throw(n))):e(t.next(r.value))}return e(t.next())}var w=class{[Symbol.dispose](){return this.dispose()}},$=Symbol.dispose??Symbol.for("Symbol.dispose"),K=w.prototype;K[$]||(K[$]=function(){return this.dispose()});var y=class ie extends w{constructor(e,r,n,s){super(),this._value=e,this.copier=r,this.disposer=n,this._owner=s,this._alive=!0,this._constructorStack=void 0}get alive(){return this._alive}get value(){return this.assertAlive(),this._value}get owner(){return this._owner}get dupable(){return!!this.copier}dup(){if(this.assertAlive(),!this.copier)throw new Error("Non-dupable lifetime");return new ie(this.copier(this._value),this.copier,this.disposer,this._owner)}consume(e){this.assertAlive();let r=e(this);return this.dispose(),r}map(e){return this.assertAlive(),e(this)}tap(e){return e(this),this}dispose(){this.assertAlive(),this.disposer&&this.disposer(this._value),this._alive=!1}assertAlive(){if(!this.alive)throw this._constructorStack?new B(`Lifetime not alive
${this._constructorStack}
Lifetime used`):new B("Lifetime not alive")}},b=class extends y{constructor(t,e){super(t,void 0,void 0,e)}get dupable(){return!0}dup(){return this}dispose(){}},W=class extends y{constructor(t,e,r,n){super(t,e,r,n)}dispose(){this._alive=!1}};function M(t,e){let r;try{t.dispose()}catch(n){r=n}if(e&&r)throw Object.assign(e,{message:`${e.message}
 Then, failed to dispose scope: ${r.message}`,disposeError:r}),e;if(e||r)throw e||r}var S=class _ extends w{constructor(){super(...arguments),this._disposables=new y(new Set),this.manage=e=>(this._disposables.value.add(e),e)}static withScope(e){let r=new _,n;try{return e(r)}catch(s){throw n=s,s}finally{M(r,n)}}static withScopeMaybeAsync(e,r){return Ce(void 0,function*(n){let s=new _,i;try{return yield*n.of(r.call(e,n,s))}catch(a){throw i=a,a}finally{M(s,i)}})}static async withScopeAsync(e){let r=new _,n;try{return await e(r)}catch(s){throw n=s,s}finally{M(r,n)}}get alive(){return this._disposables.alive}dispose(){let e=Array.from(this._disposables.value.values()).reverse();for(let r of e)r.alive&&r.dispose();this._disposables.dispose()}};function _e(t){let e=t?Array.from(t):[];function r(){return e.forEach(s=>s.alive?s.dispose():void 0)}function n(){return e.some(s=>s.alive)}return Object.defineProperty(e,$,{configurable:!0,enumerable:!1,value:r}),Object.defineProperty(e,"dispose",{configurable:!0,enumerable:!1,value:r}),Object.defineProperty(e,"alive",{configurable:!0,enumerable:!1,get:n}),e}function L(t){return!!(t&&(typeof t=="object"||typeof t=="function")&&"alive"in t&&typeof t.alive=="boolean"&&"dispose"in t&&typeof t.dispose=="function")}var U=class oe extends w{static success(e){return new Pe(e)}static fail(e,r){return new Ie(e,r)}static is(e){return e instanceof oe}},Pe=class extends U{constructor(t){super(),this.value=t}get alive(){return L(this.value)?this.value.alive:!0}dispose(){L(this.value)&&this.value.dispose()}unwrap(){return this.value}unwrapOr(t){return this.value}},Ie=class extends U{constructor(t,e){super(),this.error=t,this.onUnwrap=e}get alive(){return L(this.error)?this.error.alive:!0}dispose(){L(this.error)&&this.error.dispose()}unwrap(){throw this.onUnwrap(this),this.error}unwrapOr(t){return t}},T=U,Le=class extends w{constructor(t){super(),this.resolve=e=>{this.resolveHandle.alive&&(this.context.unwrapResult(this.context.callFunction(this.resolveHandle,this.context.undefined,e||this.context.undefined)).dispose(),this.disposeResolvers(),this.onSettled())},this.reject=e=>{this.rejectHandle.alive&&(this.context.unwrapResult(this.context.callFunction(this.rejectHandle,this.context.undefined,e||this.context.undefined)).dispose(),this.disposeResolvers(),this.onSettled())},this.dispose=()=>{this.handle.alive&&this.handle.dispose(),this.disposeResolvers()},this.context=t.context,this.owner=t.context.runtime,this.handle=t.promiseHandle,this.settled=new Promise(e=>{this.onSettled=e}),this.resolveHandle=t.resolveHandle,this.rejectHandle=t.rejectHandle}get alive(){return this.handle.alive||this.resolveHandle.alive||this.rejectHandle.alive}disposeResolvers(){this.resolveHandle.alive&&this.resolveHandle.dispose(),this.rejectHandle.alive&&this.rejectHandle.dispose()}},ae=class{constructor(t){this.module=t}toPointerArray(t){let e=new Int32Array(t.map(s=>s.value)),r=e.length*e.BYTES_PER_ELEMENT,n=this.module._malloc(r);return new Uint8Array(this.module.HEAPU8.buffer,n,r).set(new Uint8Array(e.buffer)),new y(n,void 0,s=>this.module._free(s))}newTypedArray(t,e){let r=new t(new Array(e).fill(0)),n=r.length*r.BYTES_PER_ELEMENT,s=this.module._malloc(n),i=new t(this.module.HEAPU8.buffer,s,e);return i.set(r),new y({typedArray:i,ptr:s},void 0,a=>this.module._free(a.ptr))}newMutablePointerArray(t){return this.newTypedArray(Int32Array,t)}newHeapCharPointer(t){let e=this.module.lengthBytesUTF8(t),r=e+1,n=this.module._malloc(r);return this.module.stringToUTF8(t,n,r),new y({ptr:n,strlen:e},void 0,s=>this.module._free(s.ptr))}newHeapBufferPointer(t){let e=t.byteLength,r=this.module._malloc(e);return this.module.HEAPU8.set(t,r),new y({pointer:r,numBytes:e},void 0,n=>this.module._free(n.pointer))}consumeHeapCharPointer(t){let e=this.module.UTF8ToString(t);return this.module._free(t),e}};function Ne(t){if(!t)return 0;let e=0;for(let[r,n]of Object.entries(t)){if(!(r in V))throw new te(r);n&&(e|=V[r])}return e}function Me(t){if(typeof t=="number")return t;if(t===void 0)return 0;let{type:e,strict:r,strip:n,compileOnly:s,backtraceBarrier:i}=t,a=0;return e==="global"&&(a|=x.JS_EVAL_TYPE_GLOBAL),e==="module"&&(a|=x.JS_EVAL_TYPE_MODULE),r&&(a|=x.JS_EVAL_FLAG_STRICT),n&&(a|=x.JS_EVAL_FLAG_STRIP),s&&(a|=x.JS_EVAL_FLAG_COMPILE_ONLY),i&&(a|=x.JS_EVAL_FLAG_BACKTRACE_BARRIER),a}function Oe(t){if(typeof t=="number")return t;if(t===void 0)return 0;let{strings:e,symbols:r,quickjsPrivate:n,onlyEnumerable:s,numbers:i,numbersAsStrings:a}=t,l=0;return e&&(l|=A.JS_GPN_STRING_MASK),r&&(l|=A.JS_GPN_SYMBOL_MASK),n&&(l|=A.JS_GPN_PRIVATE_MASK),s&&(l|=A.JS_GPN_ENUM_ONLY),i&&(l|=A.QTS_GPN_NUMBER_MASK),a&&(l|=A.QTS_STANDARD_COMPLIANT_NUMBER),l}function Fe(...t){let e=[];for(let r of t)r!==void 0&&(e=e.concat(r));return e}var Qe=class extends w{constructor(t,e){super(),this.handle=t,this.context=e,this._isDone=!1,this.owner=e.runtime}[Symbol.iterator](){return this}next(t){if(!this.alive||this._isDone)return{done:!0,value:void 0};let e=this._next??(this._next=this.context.getProp(this.handle,"next"));return this.callIteratorMethod(e,t)}return(t){if(!this.alive)return{done:!0,value:void 0};let e=this.context.getProp(this.handle,"return");if(e===this.context.undefined&&t===void 0)return this.dispose(),{done:!0,value:void 0};let r=this.callIteratorMethod(e,t);return e.dispose(),this.dispose(),r}throw(t){if(!this.alive)return{done:!0,value:void 0};let e=t instanceof y?t:this.context.newError(t),r=this.context.getProp(this.handle,"throw"),n=this.callIteratorMethod(r,t);return e.alive&&e.dispose(),r.dispose(),this.dispose(),n}get alive(){return this.handle.alive}dispose(){var t;this._isDone=!0,this.handle.dispose(),(t=this._next)==null||t.dispose()}callIteratorMethod(t,e){let r=e?this.context.callFunction(t,this.handle,e):this.context.callFunction(t,this.handle);if(r.error)return this.dispose(),{value:r};let n=this.context.getProp(r.value,"done").consume(i=>this.context.dump(i));if(n)return r.value.dispose(),this.dispose(),{done:n,value:void 0};let s=this.context.getProp(r.value,"value");return r.value.dispose(),{value:T.success(s),done:n}}},Be=class extends ae{constructor(t){var e;super(t.module),this.scope=new S,this.copyJSValue=r=>this.ffi.QTS_DupValuePointer(this.ctx.value,r),this.freeJSValue=r=>{this.ffi.QTS_FreeValuePointer(this.ctx.value,r)},(e=t.ownedLifetimes)==null||e.forEach(r=>this.scope.manage(r)),this.owner=t.owner,this.module=t.module,this.ffi=t.ffi,this.rt=t.rt,this.ctx=this.scope.manage(t.ctx)}get alive(){return this.scope.alive}dispose(){return this.scope.dispose()}[Symbol.dispose](){return this.dispose()}manage(t){return this.scope.manage(t)}consumeJSCharPointer(t){let e=this.module.UTF8ToString(t);return this.ffi.QTS_FreeCString(this.ctx.value,t),e}heapValueHandle(t){return new y(t,this.copyJSValue,this.freeJSValue,this.owner)}staticHeapValueHandle(t){return this.manage(this.heapValueHandle(t)),new b(t,this.owner)}},De=class extends w{constructor(t){super(),this._undefined=void 0,this._null=void 0,this._false=void 0,this._true=void 0,this._global=void 0,this._BigInt=void 0,this._Symbol=void 0,this._SymbolIterator=void 0,this._SymbolAsyncIterator=void 0,this.fnNextId=-32768,this.fnMaps=new Map,this.cToHostCallbacks={callFunction:(e,r,n,s,i)=>{if(e!==this.ctx.value)throw new Error("QuickJSContext instance received C -> JS call with mismatched ctx");let a=this.getFunction(i);if(!a)throw new Error(`QuickJSContext had no callback with id ${i}`);return S.withScopeMaybeAsync(this,function*(l,u){let h=u.manage(new W(r,this.memory.copyJSValue,this.memory.freeJSValue,this.runtime)),m=new Array(n);for(let f=0;f<n;f++){let p=this.ffi.QTS_ArgvGetJSValueConstPointer(s,f);m[f]=u.manage(new W(p,this.memory.copyJSValue,this.memory.freeJSValue,this.runtime))}try{let f=yield*l(a.apply(h,m));if(f){if("error"in f&&f.error)throw this.runtime.debugLog("throw error",f.error),f.error;let p=u.manage(f instanceof y?f:f.value);return this.ffi.QTS_DupValuePointer(this.ctx.value,p.value)}return 0}catch(f){return this.errorToHandle(f).consume(p=>this.ffi.QTS_Throw(this.ctx.value,p.value))}})}},this.runtime=t.runtime,this.module=t.module,this.ffi=t.ffi,this.rt=t.rt,this.ctx=t.ctx,this.memory=new Be({...t,owner:this.runtime}),t.callbacks.setContextCallbacks(this.ctx.value,this.cToHostCallbacks),this.dump=this.dump.bind(this),this.getString=this.getString.bind(this),this.getNumber=this.getNumber.bind(this),this.resolvePromise=this.resolvePromise.bind(this),this.uint32Out=this.memory.manage(this.memory.newTypedArray(Uint32Array,1))}get alive(){return this.memory.alive}dispose(){this.memory.dispose()}get undefined(){if(this._undefined)return this._undefined;let t=this.ffi.QTS_GetUndefined();return this._undefined=new b(t)}get null(){if(this._null)return this._null;let t=this.ffi.QTS_GetNull();return this._null=new b(t)}get true(){if(this._true)return this._true;let t=this.ffi.QTS_GetTrue();return this._true=new b(t)}get false(){if(this._false)return this._false;let t=this.ffi.QTS_GetFalse();return this._false=new b(t)}get global(){if(this._global)return this._global;let t=this.ffi.QTS_GetGlobalObject(this.ctx.value);return this._global=this.memory.staticHeapValueHandle(t),this._global}newNumber(t){return this.memory.heapValueHandle(this.ffi.QTS_NewFloat64(this.ctx.value,t))}newString(t){let e=this.memory.newHeapCharPointer(t).consume(r=>this.ffi.QTS_NewString(this.ctx.value,r.value.ptr));return this.memory.heapValueHandle(e)}newUniqueSymbol(t){let e=(typeof t=="symbol"?t.description:t)??"",r=this.memory.newHeapCharPointer(e).consume(n=>this.ffi.QTS_NewSymbol(this.ctx.value,n.value.ptr,0));return this.memory.heapValueHandle(r)}newSymbolFor(t){let e=(typeof t=="symbol"?t.description:t)??"",r=this.memory.newHeapCharPointer(e).consume(n=>this.ffi.QTS_NewSymbol(this.ctx.value,n.value.ptr,1));return this.memory.heapValueHandle(r)}getWellKnownSymbol(t){return this._Symbol??(this._Symbol=this.memory.manage(this.getProp(this.global,"Symbol"))),this.getProp(this._Symbol,t)}newBigInt(t){if(!this._BigInt){let n=this.getProp(this.global,"BigInt");this.memory.manage(n),this._BigInt=new b(n.value,this.runtime)}let e=this._BigInt,r=String(t);return this.newString(r).consume(n=>this.unwrapResult(this.callFunction(e,this.undefined,n)))}newObject(t){t&&this.runtime.assertOwned(t);let e=t?this.ffi.QTS_NewObjectProto(this.ctx.value,t.value):this.ffi.QTS_NewObject(this.ctx.value);return this.memory.heapValueHandle(e)}newArray(){let t=this.ffi.QTS_NewArray(this.ctx.value);return this.memory.heapValueHandle(t)}newArrayBuffer(t){let e=new Uint8Array(t),r=this.memory.newHeapBufferPointer(e),n=this.ffi.QTS_NewArrayBuffer(this.ctx.value,r.value.pointer,e.length);return this.memory.heapValueHandle(n)}newPromise(t){let e=S.withScope(r=>{let n=r.manage(this.memory.newMutablePointerArray(2)),s=this.ffi.QTS_NewPromiseCapability(this.ctx.value,n.value.ptr),i=this.memory.heapValueHandle(s),[a,l]=Array.from(n.value.typedArray).map(u=>this.memory.heapValueHandle(u));return new Le({context:this,promiseHandle:i,resolveHandle:a,rejectHandle:l})});return t&&typeof t=="function"&&(t=new Promise(t)),t&&Promise.resolve(t).then(e.resolve,r=>r instanceof y?e.reject(r):this.newError(r).consume(e.reject)),e}newFunction(t,e){let r=++this.fnNextId;return this.setFunction(r,e),this.memory.heapValueHandle(this.ffi.QTS_NewFunction(this.ctx.value,r,t))}newError(t){let e=this.memory.heapValueHandle(this.ffi.QTS_NewError(this.ctx.value));return t&&typeof t=="object"?(t.name!==void 0&&this.newString(t.name).consume(r=>this.setProp(e,"name",r)),t.message!==void 0&&this.newString(t.message).consume(r=>this.setProp(e,"message",r))):typeof t=="string"?this.newString(t).consume(r=>this.setProp(e,"message",r)):t!==void 0&&this.newString(String(t)).consume(r=>this.setProp(e,"message",r)),e}typeof(t){return this.runtime.assertOwned(t),this.memory.consumeHeapCharPointer(this.ffi.QTS_Typeof(this.ctx.value,t.value))}getNumber(t){return this.runtime.assertOwned(t),this.ffi.QTS_GetFloat64(this.ctx.value,t.value)}getString(t){return this.runtime.assertOwned(t),this.memory.consumeJSCharPointer(this.ffi.QTS_GetString(this.ctx.value,t.value))}getSymbol(t){this.runtime.assertOwned(t);let e=this.memory.consumeJSCharPointer(this.ffi.QTS_GetSymbolDescriptionOrKey(this.ctx.value,t.value));return this.ffi.QTS_IsGlobalSymbol(this.ctx.value,t.value)?Symbol.for(e):Symbol(e)}getBigInt(t){this.runtime.assertOwned(t);let e=this.getString(t);return BigInt(e)}getArrayBuffer(t){this.runtime.assertOwned(t);let e=this.ffi.QTS_GetArrayBufferLength(this.ctx.value,t.value),r=this.ffi.QTS_GetArrayBuffer(this.ctx.value,t.value);if(!r)throw new Error("Couldn't allocate memory to get ArrayBuffer");return new y(this.module.HEAPU8.subarray(r,r+e),void 0,()=>this.module._free(r))}getPromiseState(t){this.runtime.assertOwned(t);let e=this.ffi.QTS_PromiseState(this.ctx.value,t.value);if(e<0)return{type:"fulfilled",value:t,notAPromise:!0};if(e===N.Pending)return{type:"pending",get error(){return new re("Cannot unwrap a pending promise")}};let r=this.ffi.QTS_PromiseResult(this.ctx.value,t.value),n=this.memory.heapValueHandle(r);if(e===N.Fulfilled)return{type:"fulfilled",value:n};if(e===N.Rejected)return{type:"rejected",error:n};throw n.dispose(),new Error(`Unknown JSPromiseStateEnum: ${e}`)}resolvePromise(t){this.runtime.assertOwned(t);let e=S.withScope(r=>{let n=r.manage(this.getProp(this.global,"Promise")),s=r.manage(this.getProp(n,"resolve"));return this.callFunction(s,n,t)});return e.error?Promise.resolve(e):new Promise(r=>{S.withScope(n=>{let s=n.manage(this.newFunction("resolve",u=>{r(this.success(u&&u.dup()))})),i=n.manage(this.newFunction("reject",u=>{r(this.fail(u&&u.dup()))})),a=n.manage(e.value),l=n.manage(this.getProp(a,"then"));this.callFunction(l,a,s,i).unwrap().dispose()})})}isEqual(t,e,r=C.IsStrictlyEqual){if(t===e)return!0;this.runtime.assertOwned(t),this.runtime.assertOwned(e);let n=this.ffi.QTS_IsEqual(this.ctx.value,t.value,e.value,r);if(n===-1)throw new Z("WASM variant does not expose equality");return!!n}eq(t,e){return this.isEqual(t,e,C.IsStrictlyEqual)}sameValue(t,e){return this.isEqual(t,e,C.IsSameValue)}sameValueZero(t,e){return this.isEqual(t,e,C.IsSameValueZero)}getProp(t,e){this.runtime.assertOwned(t);let r;return typeof e=="number"&&e>=0?r=this.ffi.QTS_GetPropNumber(this.ctx.value,t.value,e):r=this.borrowPropertyKey(e).consume(n=>this.ffi.QTS_GetProp(this.ctx.value,t.value,n.value)),this.memory.heapValueHandle(r)}getLength(t){if(this.runtime.assertOwned(t),!(this.ffi.QTS_GetLength(this.ctx.value,this.uint32Out.value.ptr,t.value)<0))return this.uint32Out.value.typedArray[0]}getOwnPropertyNames(t,e={strings:!0,numbersAsStrings:!0}){this.runtime.assertOwned(t),t.value;let r=Oe(e);if(r===0)throw new ne("No options set, will return an empty array");return S.withScope(n=>{let s=n.manage(this.memory.newMutablePointerArray(1)),i=this.ffi.QTS_GetOwnPropertyNames(this.ctx.value,s.value.ptr,this.uint32Out.value.ptr,t.value,r);if(i)return this.fail(this.memory.heapValueHandle(i));let a=this.uint32Out.value.typedArray[0],l=s.value.typedArray[0],u=new Uint32Array(this.module.HEAP8.buffer,l,a),h=Array.from(u).map(m=>this.memory.heapValueHandle(m));return this.ffi.QTS_FreeVoidPointer(this.ctx.value,l),this.success(_e(h))})}getIterator(t){let e=this._SymbolIterator??(this._SymbolIterator=this.memory.manage(this.getWellKnownSymbol("iterator")));return S.withScope(r=>{let n=r.manage(this.getProp(t,e)),s=this.callFunction(n,t);return s.error?s:this.success(new Qe(s.value,this))})}setProp(t,e,r){this.runtime.assertOwned(t),this.borrowPropertyKey(e).consume(n=>this.ffi.QTS_SetProp(this.ctx.value,t.value,n.value,r.value))}defineProp(t,e,r){this.runtime.assertOwned(t),S.withScope(n=>{let s=n.manage(this.borrowPropertyKey(e)),i=r.value||this.undefined,a=!!r.configurable,l=!!r.enumerable,u=!!r.value,h=r.get?n.manage(this.newFunction(r.get.name,r.get)):this.undefined,m=r.set?n.manage(this.newFunction(r.set.name,r.set)):this.undefined;this.ffi.QTS_DefineProp(this.ctx.value,t.value,s.value,i.value,h.value,m.value,a,l,u)})}callFunction(t,e,...r){this.runtime.assertOwned(t);let n,s=r[0];s===void 0||Array.isArray(s)?n=s??[]:n=r;let i=this.memory.toPointerArray(n).consume(l=>this.ffi.QTS_Call(this.ctx.value,t.value,e.value,n.length,l.value)),a=this.ffi.QTS_ResolveException(this.ctx.value,i);return a?(this.ffi.QTS_FreeValuePointer(this.ctx.value,i),this.fail(this.memory.heapValueHandle(a))):this.success(this.memory.heapValueHandle(i))}callMethod(t,e,r=[]){return this.getProp(t,e).consume(n=>this.callFunction(n,t,r))}evalCode(t,e="eval.js",r){let n=r===void 0?1:0,s=Me(r),i=this.memory.newHeapCharPointer(t).consume(l=>this.ffi.QTS_Eval(this.ctx.value,l.value.ptr,l.value.strlen,e,n,s)),a=this.ffi.QTS_ResolveException(this.ctx.value,i);return a?(this.ffi.QTS_FreeValuePointer(this.ctx.value,i),this.fail(this.memory.heapValueHandle(a))):this.success(this.memory.heapValueHandle(i))}throw(t){return this.errorToHandle(t).consume(e=>this.ffi.QTS_Throw(this.ctx.value,e.value))}borrowPropertyKey(t){return typeof t=="number"?this.newNumber(t):typeof t=="string"?this.newString(t):new b(t.value,this.runtime)}getMemory(t){if(t===this.rt.value)return this.memory;throw new Error("Private API. Cannot get memory from a different runtime")}dump(t){this.runtime.assertOwned(t);let e=this.typeof(t);if(e==="string")return this.getString(t);if(e==="number")return this.getNumber(t);if(e==="bigint")return this.getBigInt(t);if(e==="undefined")return;if(e==="symbol")return this.getSymbol(t);let r=this.getPromiseState(t);if(r.type==="fulfilled"&&!r.notAPromise)return t.dispose(),{type:r.type,value:r.value.consume(this.dump)};if(r.type==="pending")return t.dispose(),{type:r.type};if(r.type==="rejected")return t.dispose(),{type:r.type,error:r.error.consume(this.dump)};let n=this.memory.consumeJSCharPointer(this.ffi.QTS_Dump(this.ctx.value,t.value));try{return JSON.parse(n)}catch{return n}}unwrapResult(t){if(t.error){let e="context"in t.error?t.error.context:this,r=t.error.consume(n=>this.dump(n));if(r&&typeof r=="object"&&typeof r.message=="string"){let{message:n,name:s,stack:i,...a}=r,l=new Q(r,e);typeof s=="string"&&(l.name=r.name),l.message=n;let u=l.stack;throw typeof i=="string"&&(l.stack=`${s}: ${n}
${r.stack}Host: ${u}`),Object.assign(l,a),l}throw new Q(r)}return t.value}[Symbol.for("nodejs.util.inspect.custom")](){return this.alive?`${this.constructor.name} { ctx: ${this.ctx.value} rt: ${this.rt.value} }`:`${this.constructor.name} { disposed }`}getFunction(t){let e=t>>8,r=this.fnMaps.get(e);if(r)return r.get(t)}setFunction(t,e){let r=t>>8,n=this.fnMaps.get(r);return n||(n=new Map,this.fnMaps.set(r,n)),n.set(t,e)}errorToHandle(t){return t instanceof y?t:this.newError(t)}encodeBinaryJSON(t){let e=this.ffi.QTS_bjson_encode(this.ctx.value,t.value);return this.memory.heapValueHandle(e)}decodeBinaryJSON(t){let e=this.ffi.QTS_bjson_decode(this.ctx.value,t.value);return this.memory.heapValueHandle(e)}success(t){return T.success(t)}fail(t){return T.fail(t,e=>this.unwrapResult(e))}},$e=class extends w{constructor(t){var e;super(),this.scope=new S,this.contextMap=new Map,this._debugMode=!1,this.cToHostCallbacks={shouldInterrupt:r=>{if(r!==this.rt.value)throw new Error("QuickJSContext instance received C -> JS interrupt with mismatched rt");let n=this.interruptHandler;if(!n)throw new Error("QuickJSContext had no interrupt handler");return n(this)?1:0},loadModuleSource:G(this,function*(r,n,s,i){let a=this.moduleLoader;if(!a)throw new Error("Runtime has no module loader");if(n!==this.rt.value)throw new Error("Runtime pointer mismatch");let l=this.contextMap.get(s)??this.newContext({contextPointer:s});try{let u=yield*r(a(i,l));if(typeof u=="object"&&"error"in u&&u.error)throw this.debugLog("cToHostLoadModule: loader returned error",u.error),u.error;let h=typeof u=="string"?u:"value"in u?u.value:u;return this.memory.newHeapCharPointer(h).value.ptr}catch(u){return this.debugLog("cToHostLoadModule: caught error",u),l.throw(u),0}}),normalizeModule:G(this,function*(r,n,s,i,a){let l=this.moduleNormalizer;if(!l)throw new Error("Runtime has no module normalizer");if(n!==this.rt.value)throw new Error("Runtime pointer mismatch");let u=this.contextMap.get(s)??this.newContext({contextPointer:s});try{let h=yield*r(l(i,a,u));if(typeof h=="object"&&"error"in h&&h.error)throw this.debugLog("cToHostNormalizeModule: normalizer returned error",h.error),h.error;let m=typeof h=="string"?h:h.value;return u.getMemory(this.rt.value).newHeapCharPointer(m).value.ptr}catch(h){return this.debugLog("normalizeModule: caught error",h),u.throw(h),0}})},(e=t.ownedLifetimes)==null||e.forEach(r=>this.scope.manage(r)),this.module=t.module,this.memory=new ae(this.module),this.ffi=t.ffi,this.rt=t.rt,this.callbacks=t.callbacks,this.scope.manage(this.rt),this.callbacks.setRuntimeCallbacks(this.rt.value,this.cToHostCallbacks),this.executePendingJobs=this.executePendingJobs.bind(this)}get alive(){return this.scope.alive}dispose(){return this.scope.dispose()}newContext(t={}){let e=Ne(t.intrinsics),r=new y(t.contextPointer||this.ffi.QTS_NewContext(this.rt.value,e),void 0,s=>{this.contextMap.delete(s),this.callbacks.deleteContext(s),this.ffi.QTS_FreeContext(s)}),n=new De({module:this.module,ctx:r,ffi:this.ffi,rt:this.rt,ownedLifetimes:t.ownedLifetimes,runtime:this,callbacks:this.callbacks});return this.contextMap.set(r.value,n),n}setModuleLoader(t,e){this.moduleLoader=t,this.moduleNormalizer=e,this.ffi.QTS_RuntimeEnableModuleLoader(this.rt.value,this.moduleNormalizer?1:0)}removeModuleLoader(){this.moduleLoader=void 0,this.ffi.QTS_RuntimeDisableModuleLoader(this.rt.value)}hasPendingJob(){return!!this.ffi.QTS_IsJobPending(this.rt.value)}setInterruptHandler(t){let e=this.interruptHandler;this.interruptHandler=t,e||this.ffi.QTS_RuntimeEnableInterruptHandler(this.rt.value)}removeInterruptHandler(){this.interruptHandler&&(this.ffi.QTS_RuntimeDisableInterruptHandler(this.rt.value),this.interruptHandler=void 0)}executePendingJobs(t=-1){let e=this.memory.newMutablePointerArray(1),r=this.ffi.QTS_ExecutePendingJob(this.rt.value,t??-1,e.value.ptr),n=e.value.typedArray[0];if(e.dispose(),n===0)return this.ffi.QTS_FreeValuePointerRuntime(this.rt.value,r),T.success(0);let s=this.contextMap.get(n)??this.newContext({contextPointer:n}),i=s.getMemory(this.rt.value).heapValueHandle(r);if(s.typeof(i)==="number"){let a=s.getNumber(i);return i.dispose(),T.success(a)}else{let a=Object.assign(i,{context:s});return T.fail(a,l=>s.unwrapResult(l))}}setMemoryLimit(t){if(t<0&&t!==-1)throw new Error("Cannot set memory limit to negative number. To unset, pass -1");this.ffi.QTS_RuntimeSetMemoryLimit(this.rt.value,t)}computeMemoryUsage(){let t=this.getSystemContext().getMemory(this.rt.value);return t.heapValueHandle(this.ffi.QTS_RuntimeComputeMemoryUsage(this.rt.value,t.ctx.value))}dumpMemoryUsage(){return this.memory.consumeHeapCharPointer(this.ffi.QTS_RuntimeDumpMemoryUsage(this.rt.value))}setMaxStackSize(t){if(t<0)throw new Error("Cannot set memory limit to negative number. To unset, pass 0.");this.ffi.QTS_RuntimeSetMaxStackSize(this.rt.value,t)}assertOwned(t){if(t.owner&&t.owner.rt!==this.rt)throw new Y(`Handle is not owned by this runtime: ${t.owner.rt.value} != ${this.rt.value}`)}setDebugMode(t){this._debugMode=t,this.ffi.DEBUG&&this.rt.alive&&this.ffi.QTS_SetDebugLogEnabled(this.rt.value,t?1:0)}isDebugMode(){return this._debugMode}debugLog(...t){this._debugMode&&console.log("quickjs-emscripten:",...t)}[Symbol.for("nodejs.util.inspect.custom")](){return this.alive?`${this.constructor.name} { rt: ${this.rt.value} }`:`${this.constructor.name} { disposed }`}getSystemContext(){return this.context||(this.context=this.scope.manage(this.newContext())),this.context}},He=class{constructor(t){this.callFunction=t.callFunction,this.shouldInterrupt=t.shouldInterrupt,this.loadModuleSource=t.loadModuleSource,this.normalizeModule=t.normalizeModule}},le=class{constructor(t){this.contextCallbacks=new Map,this.runtimeCallbacks=new Map,this.suspendedCount=0,this.cToHostCallbacks=new He({callFunction:(e,r,n,s,i,a)=>this.handleAsyncify(e,()=>{try{let l=this.contextCallbacks.get(r);if(!l)throw new Error(`QuickJSContext(ctx = ${r}) not found for C function call "${a}"`);return l.callFunction(r,n,s,i,a)}catch(l){return console.error("[C to host error: returning null]",l),0}}),shouldInterrupt:(e,r)=>this.handleAsyncify(e,()=>{try{let n=this.runtimeCallbacks.get(r);if(!n)throw new Error(`QuickJSRuntime(rt = ${r}) not found for C interrupt`);return n.shouldInterrupt(r)}catch(n){return console.error("[C to host interrupt: returning error]",n),1}}),loadModuleSource:(e,r,n,s)=>this.handleAsyncify(e,()=>{try{let i=this.runtimeCallbacks.get(r);if(!i)throw new Error(`QuickJSRuntime(rt = ${r}) not found for C module loader`);let a=i.loadModuleSource;if(!a)throw new Error(`QuickJSRuntime(rt = ${r}) does not support module loading`);return a(r,n,s)}catch(i){return console.error("[C to host module loader error: returning null]",i),0}}),normalizeModule:(e,r,n,s,i)=>this.handleAsyncify(e,()=>{try{let a=this.runtimeCallbacks.get(r);if(!a)throw new Error(`QuickJSRuntime(rt = ${r}) not found for C module loader`);let l=a.normalizeModule;if(!l)throw new Error(`QuickJSRuntime(rt = ${r}) does not support module loading`);return l(r,n,s,i)}catch(a){return console.error("[C to host module loader error: returning null]",a),0}})}),this.module=t,this.module.callbacks=this.cToHostCallbacks}setRuntimeCallbacks(t,e){this.runtimeCallbacks.set(t,e)}deleteRuntime(t){this.runtimeCallbacks.delete(t)}setContextCallbacks(t,e){this.contextCallbacks.set(t,e)}deleteContext(t){this.contextCallbacks.delete(t)}handleAsyncify(t,e){if(t)return t.handleSleep(n=>{try{let s=e();if(!(s instanceof Promise)){R("asyncify.handleSleep: not suspending:",s),n(s);return}if(this.suspended)throw new X(`Already suspended at: ${this.suspended.stack}
Attempted to suspend at:`);this.suspended=new ee(`(${this.suspendedCount++})`),R("asyncify.handleSleep: suspending:",this.suspended),s.then(i=>{this.suspended=void 0,R("asyncify.handleSleep: resolved:",i),n(i)},i=>{R("asyncify.handleSleep: rejected:",i),console.error("QuickJS: cannot handle error in suspended function",i),this.suspended=void 0})}catch(s){throw this.suspended=void 0,s}});let r=e();if(r instanceof Promise)throw new Error("Promise return value not supported in non-asyncify context.");return r}};function ue(t,e){e.interruptHandler&&t.setInterruptHandler(e.interruptHandler),e.maxStackSizeBytes!==void 0&&t.setMaxStackSize(e.maxStackSizeBytes),e.memoryLimitBytes!==void 0&&t.setMemoryLimit(e.memoryLimitBytes)}function ce(t,e){e.moduleLoader&&t.setModuleLoader(e.moduleLoader),e.shouldInterrupt&&t.setInterruptHandler(e.shouldInterrupt),e.memoryLimitBytes!==void 0&&t.setMemoryLimit(e.memoryLimitBytes),e.maxStackSizeBytes!==void 0&&t.setMaxStackSize(e.maxStackSizeBytes)}var Je=class{constructor(t,e){this.module=t,this.ffi=e,this.callbacks=new le(t)}newRuntime(t={}){let e=new y(this.ffi.QTS_NewRuntime(),void 0,n=>{this.callbacks.deleteRuntime(n),this.ffi.QTS_FreeRuntime(n)}),r=new $e({module:this.module,callbacks:this.callbacks,ffi:this.ffi,rt:e});return ue(r,t),t.moduleLoader&&r.setModuleLoader(t.moduleLoader),r}newContext(t={}){let e=this.newRuntime(),r=e.newContext({...t,ownedLifetimes:Fe(e,t.ownedLifetimes)});return e.context=r,r}evalCode(t,e={}){return S.withScope(r=>{let n=r.manage(this.newContext());ce(n.runtime,e);let s=n.evalCode(t,"eval.js");if(e.memoryLimitBytes!==void 0&&n.runtime.setMemoryLimit(-1),s.error)throw n.dump(r.manage(s.error));return n.dump(r.manage(s.value))})}getWasmMemory(){var e,r,n,s;let t=(s=(n=(r=(e=this.module).quickjsEmscriptenInit)==null?void 0:r.call(e,()=>{}))==null?void 0:n.getWasmMemory)==null?void 0:s.call(n);if(!t)throw new Error("Variant does not support getting WebAssembly.Memory");return t}getFFI(){return this.ffi}};async function Ue(t){let e=P(await t),[r,n,{QuickJSWASMModule:s}]=await Promise.all([e.importModuleLoader().then(P),e.importFFI(),F(()=>Promise.resolve().then(()=>Xe),void 0).then(P)]),i=await r();i.type="sync";let a=new n(i);return new s(i,a)}function P(t){return t&&"default"in t&&t.default?t.default&&"default"in t.default&&t.default.default?t.default.default:t.default:t}function je(t,e){return{...t,async importModuleLoader(){let r=P(await t.importModuleLoader());return async function(){var f;let n=e.emscriptenModule?{...e.emscriptenModule}:{},s=e.log??((...p)=>R("newVariant moduleLoader:",...p)),i=(p,v)=>(s(...p,v),v),a=p=>typeof p=="function"?p():p;(e.wasmLocation||e.wasmSourceMapLocation||e.locateFile)&&(n.locateFile=(p,v)=>{let E={fileName:p,relativeTo:v};if(p.endsWith(".wasm")&&e.wasmLocation!==void 0)return i(["locateFile .wasm: provide wasmLocation",E],e.wasmLocation);if(p.endsWith(".map")){if(e.wasmSourceMapLocation!==void 0)return i(["locateFile .map: provide wasmSourceMapLocation",E],e.wasmSourceMapLocation);if(e.wasmLocation&&!e.locateFile)return i(["locateFile .map: infer from wasmLocation",E],e.wasmLocation+".map")}return e.locateFile?i(["locateFile: use provided fn",E],e.locateFile(p,v)):i(["locateFile: unhandled, passthrough",E],p)}),e.wasmBinary&&(n.wasmBinary=await a(e.wasmBinary)),e.wasmMemory&&(n.wasmMemory=await a(e.wasmMemory));let l=e.wasmModule,u;l&&(n.instantiateWasm=async(p,v)=>{u??(u=Promise.resolve(a(l)));let E=await u;if(!E)throw new D(`options.wasmModule returned ${String(E)}`);let j=await WebAssembly.instantiate(E,p);return v(j),j.exports}),n.monitorRunDependencies=p=>{s("monitorRunDependencies:",p)},n.quickjsEmscriptenInit=()=>Ve(s);let h=r(n),m=(f=n.quickjsEmscriptenInit)==null?void 0:f.call(n,s);if(l&&(m!=null&&m.receiveWasmOffsetConverter)&&!m.existingWasmOffsetConverter){let p=await a(e.wasmBinary)??new ArrayBuffer(0);u??(u=Promise.resolve(a(l)));let v=await u;if(!v)throw new D(`options.wasmModule returned ${String(v)}`);m.receiveWasmOffsetConverter(p,v)}if(m!=null&&m.receiveSourceMapJSON){let p=await a(e.wasmSourceMapData);typeof p=="string"?m.receiveSourceMapJSON(JSON.parse(p)):p?m.receiveSourceMapJSON(p):m.receiveSourceMapJSON({version:3,names:[],sources:[],mappings:""})}return h}}}}function Ve(t){let e="mock called, emscripten module may not be initialized yet";return{mock:!0,removeRunDependency(r){t(`${e}: removeRunDependency called:`,r)},receiveSourceMapJSON(r){t(`${e}: receiveSourceMapJSON called:`,r)},WasmOffsetConverter:void 0,receiveWasmOffsetConverter(r,n){t(`${e}: receiveWasmOffsetConverter called:`,r,n)}}}var Ge={type:"sync",importFFI:()=>F(()=>import("./ffi-DlhRHxHv.js"),[]).then(t=>t.QuickJSFFI),importModuleLoader:()=>F(()=>import("./emscripten-module.browser-DS88wJvm.js"),[]).then(t=>t.default)},Ke=Ge;const We="/Verse/assets/emscripten-module-NWak2PoB.wasm",qe=je(Ke,{wasmLocation:We});async function ze(){return await Ue(qe)}self.MonacoEnvironment={getWorker(){return new Se}};const O={characterState:{hp:45,maxHp:60,level:5,spellCastings:[{name:"Cleric",slots:[{level:1,current:3,max:4},{level:2,current:2,max:3},{level:3,current:1,max:2}],spells:[{name:"Cure Wounds",level:1,damage:"1d8"},{name:"Bless",level:1,damage:""},{name:"Spiritual Weapon",level:2,damage:"1d8+3"},{name:"Revivify",level:3,damage:""}]},{name:"Wizard",slots:[{level:1,current:4,max:4},{level:2,current:3,max:3}],spells:[{name:"Magic Missile",level:1,damage:"1d4+1"},{name:"Shield",level:1,damage:""},{name:"Misty Step",level:2,damage:""}]}]},casting:{name:"Cleric",slots:[{level:1,current:3,max:4},{level:2,current:2,max:3},{level:3,current:1,max:2}],spells:[{name:"Cure Wounds",level:1,damage:"1d8"},{name:"Bless",level:1,damage:""},{name:"Spiritual Weapon",level:2,damage:"1d8+3"},{name:"Revivify",level:3,damage:""}]},slot:{level:2,current:2,max:3}},he=[{title:"Type Declarations",desc:"Define custom types and interfaces",code:`// Define custom types
type SpellLevel = number
type DamageType = string | null

interface Spell {
  name: string,
  level: SpellLevel,
  damage: DamageType
}

// Use the types
const spell: Spell = casting.spells[0]
return spell`},{title:"Typed Variables",desc:"Variables with explicit type annotations",code:`// Variable with type annotation
const level: number = 2
const filtered: Spell[] = casting.spells.filter(s => s.level <= level)
return filtered`},{title:"Typed Functions",desc:"Functions with parameter and return types",code:`// Function with type annotations
fn getSpellsAtLevel(level: number) -> Spell[] {
  const spells: Spell[] = casting.spells.filter(s => s.level == level)
  return spells
}

return getSpellsAtLevel(2)`},{title:"Union Types",desc:"Handle multiple possible types",code:`// Function with union return type
fn findSpell(name: string) -> Spell | null {
  const found: Spell | null = casting.spells.find(s => s.name == name)
  return found
}

const result: Spell | null = findSpell("Fireball")
return result`},{title:"Filter Spells by Level",desc:"Returns spells at or below level 2",code:`// Filter spells by level
const filtered = casting.spells.filter(s => s.level <= 2)
return filtered`},{title:"Nested Context Access",desc:"Access parent scope variables",code:`// Get spells for current slot level
const spells = casting.spells.filter(s => s.level == slot.level)
return spells`},{title:"Conditional Returns",desc:"Different return types based on condition",code:`// Check if spell slots available
if slot.current <= 0 {
  return null
}

const available = casting.spells.filter(s => s.level == slot.level)
return available`},{title:"HP Calculation",desc:"Calculate HP percentage",code:`// Calculate HP percentage
const hpPercent = (characterState.hp / characterState.maxHp) * 100
return hpPercent`}],me=g.createObjectType("Spell",{name:c.string,level:c.number,damage:c.string}),pe=g.createObjectType("SpellSlot",{level:c.number,current:c.number,max:c.number}),de=g.createObjectType("SpellCasting",{name:c.string,slots:g.createArrayType(pe),spells:g.createArrayType(me)}),Ye=g.createObjectType("CharacterState",{hp:c.number,maxHp:c.number,level:c.number,spellCastings:g.createArrayType(de)}),fe=new g({characterState:Ye,casting:de,slot:pe});fe.registerType("spell",me);d.register({id:"verse"});d.setMonarchTokensProvider("verse",{defaultToken:"invalid",keywords:["if","else","while","function","fn","return","let","const","for","break","continue","true","false","null"],typeKeywords:["number","string","bool","array","interface","void"],operators:["=",">","<","!","~","?",":","==","<=",">=","!=","&&","||","++","--","+","-","*","/","&","|","^","%","<<",">>",">>>","+=","-=","*=","/=","&=","|=","^=","%="],symbols:/[=><!~?:&|+\-*/^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,tokenizer:{root:[[/[a-z_$][\w$]*/,{cases:{"@typeKeywords":"type","@keywords":"keyword","@default":"identifier"}}],[/[A-Z][\w$]*/,"type.identifier"],{include:"@whitespace"},[/[{}()[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"operator","@default":""}}],[/\d*\.\d+([eE][-+]?\d+)?/,"number.float"],[/0[xX][0-9a-fA-F]+/,"number.hex"],[/\d+/,"number"],[/[;,.]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,{token:"string.quote",bracket:"@open",next:"@string"}],[/'[^\\']'/,"string"],[/(')(@escapes)(')/,["string","string.escape","string"]],[/'/,"string.invalid"]],comment:[[/[^/*]+/,"comment"],[/\/\*/,"comment","@push"],["\\*/","comment","@pop"],[/[/*]/,"comment"]],string:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,{token:"string.quote",bracket:"@close",next:"@pop"}]],whitespace:[[/[ \t\r\n]+/,"white"],[/\/\/.*$/,"comment"]]}});d.setLanguageConfiguration("verse",{comments:{lineComment:"//"},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"}],folding:{markers:{start:new RegExp("^\\s*//\\s*#?region\\b"),end:new RegExp("^\\s*//\\s*#?endregion\\b")}}});d.registerCompletionItemProvider("verse",{provideCompletionItems:(t,e)=>{const r=t.getWordUntilPosition(e),n={startLineNumber:e.lineNumber,endLineNumber:e.lineNumber,startColumn:r.startColumn,endColumn:r.endColumn};return{suggestions:[{label:"fn",kind:d.CompletionItemKind.Keyword,insertText:"fn ${1:functionName}(${2:params}) -> ${3:ReturnType} {\n	$0\n}",insertTextRules:d.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Define a function",range:n},{label:"if",kind:d.CompletionItemKind.Keyword,insertText:`if (\${1:condition}) {
	$0
}`,insertTextRules:d.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"If statement",range:n},{label:"else",kind:d.CompletionItemKind.Keyword,insertText:`else {
	$0
}`,insertTextRules:d.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Else statement",range:n},{label:"while",kind:d.CompletionItemKind.Keyword,insertText:`while (\${1:condition}) {
	$0
}`,insertTextRules:d.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"While loop",range:n},{label:"const",kind:d.CompletionItemKind.Keyword,insertText:"const ${1:name}: ${2:type} = ${3:value}",insertTextRules:d.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Constant declaration",range:n},{label:"let",kind:d.CompletionItemKind.Keyword,insertText:"let ${1:name}: ${2:type} = ${3:value}",insertTextRules:d.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Variable declaration",range:n},{label:"return",kind:d.CompletionItemKind.Keyword,insertText:"return ${1:value}",insertTextRules:d.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Return statement",range:n},{label:"string",kind:d.CompletionItemKind.TypeParameter,insertText:"string",documentation:"String type",range:n},{label:"number",kind:d.CompletionItemKind.TypeParameter,insertText:"number",documentation:"Number type",range:n},{label:"bool",kind:d.CompletionItemKind.TypeParameter,insertText:"bool",documentation:"Boolean type",range:n},{label:"array",kind:d.CompletionItemKind.TypeParameter,insertText:"array",documentation:"Array type",range:n},{label:"null",kind:d.CompletionItemKind.Keyword,insertText:"null",documentation:"Null value",range:n},{label:"interface",kind:d.CompletionItemKind.Keyword,insertText:`interface \${1:Name} {
	$0
}`,insertTextRules:d.CompletionItemInsertTextRule.InsertAsSnippet,documentation:"Interface definition",range:n},{label:"true",kind:d.CompletionItemKind.Keyword,insertText:"true",documentation:"Boolean true",range:n},{label:"false",kind:d.CompletionItemKind.Keyword,insertText:"false",documentation:"Boolean false",range:n}]}}});d.registerHoverProvider("verse",{provideHover:(t,e)=>{const r=t.getWordAtPosition(e);if(!r)return null;const s={fn:"Define a function with optional parameters and return type",if:"Conditional statement",else:"Alternative branch for if statement",while:"Loop while condition is true",const:"Declare a constant (immutable) variable",let:"Declare a mutable variable",return:"Return a value from a function",string:"Text data type",number:"Numeric data type",bool:"Boolean data type (true/false)",array:"Collection data type",null:"Represents absence of value",interface:"Define a structural type"}[r.word];return s?{range:new ve(e.lineNumber,r.startColumn,e.lineNumber,r.endColumn),contents:[{value:`**${r.word}**`},{value:s}]}:null}});z.defineTheme("verse-dark",{base:"vs-dark",inherit:!0,rules:[{token:"keyword",foreground:"C586C0",fontStyle:"bold"},{token:"type",foreground:"4EC9B0"},{token:"type.identifier",foreground:"4EC9B0"},{token:"identifier",foreground:"9CDCFE"},{token:"string",foreground:"CE9178"},{token:"number",foreground:"B5CEA8"},{token:"comment",foreground:"6A9955",fontStyle:"italic"},{token:"operator",foreground:"D4D4D4"}],colors:{"editor.background":"#1E1E1E"}});const k=z.create(document.getElementById("editor"),{value:he[0].code,language:"verse",theme:"verse-dark",automaticLayout:!0,fontSize:14,minimap:{enabled:!1},scrollBeyondLastLine:!1,lineNumbers:"on",roundedSelection:!1,padding:{top:10,bottom:10}});let I=null,q;k.onDidChangeModelContent(()=>{clearTimeout(q),q=setTimeout(()=>{ye()},500)});function ye(){const t=k.getValue();try{const e=fe.compile(t);I=e;const r=document.getElementById("typeInfo"),n=document.getElementById("compiledCode"),s=document.getElementById("statusIndicator");e.success?(r.className="type-info success",r.innerHTML=`
        <div class="type-info-label">Return Type</div>
        <div class="type-info-value">${e.returnType}</div>
      `,n.textContent=e.code,s.innerHTML='<span class="status-indicator status-success"></span>'):(r.className="type-info error",r.innerHTML=`
        <div class="type-info-label">Compilation Error</div>
        <div class="type-info-value">${e.error}</div>
      `,n.textContent="// Error during compilation",s.innerHTML='<span class="status-indicator status-error"></span>')}catch(e){console.error("Compilation error:",e)}}document.getElementById("runBtn").addEventListener("click",async()=>{if(!I||!I.success){alert("Fix compilation errors before running");return}try{const t=await ze();S.withScope(e=>{const r=e.manage(t.newContext()),n=e.manage(r.unwrapResult(r.evalCode(`
            let character = ${JSON.stringify(O.characterState)};
            let casting = ${JSON.stringify(O.casting)};
            let slot = ${JSON.stringify(O.slot)};

            function main() {
              ${I.code}
            }

            main()
          `))),s=r.dump(n),i=document.getElementById("executionResult"),a=document.getElementById("resultValue");i.style.display="block",a.textContent=JSON.stringify(s,null,2);const l=document.getElementById("consoleOutput");l.textContent=`Execution successful!

Result:
${JSON.stringify(s,null,2)}`})}catch(t){alert("Execution error: "+t.message);const e=document.getElementById("consoleOutput");e.textContent=`Error: ${t.message}`}});document.getElementById("formatBtn").addEventListener("click",()=>{const e=k.getValue().trim();k.setValue(e)});const Ze=document.getElementById("examples");he.forEach(t=>{const e=document.createElement("button");e.className="example-btn",e.innerHTML=`
    <div class="example-title">${t.title}</div>
    <div class="example-desc">${t.desc}</div>
  `,e.addEventListener("click",()=>{k.setValue(t.code)}),Ze.appendChild(e)});document.querySelectorAll(".tab").forEach(t=>{t.addEventListener("click",()=>{const e=t.dataset.tab;document.querySelectorAll(".tab").forEach(r=>r.classList.remove("active")),t.classList.add("active"),document.querySelectorAll(".tab-content").forEach(r=>r.classList.remove("active")),document.querySelector(`.tab-content[data-tab="${e}"]`).classList.add("active")})});ye();const Xe=Object.freeze(Object.defineProperty({__proto__:null,QuickJSModuleCallbacks:le,QuickJSWASMModule:Je,applyBaseRuntimeOptions:ue,applyModuleEvalRuntimeOptions:ce},Symbol.toStringTag,{value:"Module"}));
